<!DOCTYPE html>
<html lang="en">
{% extends "landing_page/base.html" %}
{% load static %}

{% block content %}

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>React Page - Food Prophet</title>
  <link rel="stylesheet" href="{{ react_assets.css }}">
  <meta name="csrf-token" content="{{ csrf_token }}">
    <link rel="stylesheet" href="{% static 'css/food_prophet.css' %}">

  {% csrf_token %}

</head>

<body>
  <div class="pulse-web"></div> <!-- Optional grid for subtle depth -->

  <div class="content-wrapper">
    <!-- Welcome Section -->
    <div class="fade-in-section">
      <h1>Welcome to <strong>The Food Prophet</strong></h1>
      <p class="subtitle">
        <em>Your Personalized Digestive Health Simulator</em>
      </p>
      <hr>
    </div>

    <!-- What is The Food Prophet Section -->
    <div class="fade-in-section delay-1">
      <h2>What is The Food Prophet?</h2>
      <p>
        <strong>A tool powered by <em>Machine Learning</em> to simulate your Digestion, revealing Patterns and Insights.</strong><br>By combining user inputs and
        natural digestion patterns, it provides a personalized journey into better
        Eating and Health habits.
      </p>
    </div>

    <!-- How It Works Section -->

    <div class="fade-in-section delay-2">
      <h2>How It Works:</h2>
      <p>
        By Mathematically modelling a person's habits around <strong>Food</strong>,
        <strong>Activity</strong> and <strong>Time</strong>, we can observe an <span class="underline">Emotionless representation
        of One's <em>Digestive System Balance</em></span>.<br>Beyond emotions, we can begin to truly understand
        the Engine of our body. <br>The simple observance, becoming aware of how entangled is
        The Digestive Balance with our <em>Mood, Feelings and Sufferings</em> - is enough for an
        effortless change to begin to happen.
      </p>
    </div>
      <div class="fade-in-section delay-21">
      <p>
        <br>Our Algorithm integrates:
      </p>

      <ul class="interactive-list">
        <li>
          <i class="fa-solid fa-clock"></i>
          <strong>Your Inputs:</strong> Sleep schedules, meal timings, and sedentary intervals.
          <div class="hover-effect">
            <pre id="hover-text-1" class="hidden"></pre>
          </div>
        </li>
        <li>
          <i class="fa-solid fa-leaf"></i>
          <strong>Natural Patterns:</strong> Circadian rhythms, digestion rates, and time dimensions.
          <div class="hover-effect">
            <pre id="hover-text-2" class="hidden"></pre>
          </div>
        </li>
        <li>
          <i class="fa-solid fa-chart-line"></i>
          <strong>Dynamic Interactions:</strong> Food quantity, timing, and logistics for realistic simulation.
          <div class="hover-effect">
            <pre id="hover-text-3" class="hidden"></pre>
          </div>
        </li>
      </ul>


      <p>
        <br>The Result? <br>A detailed, interactive model that reflects how your body processes
        <strong>food</strong> and responds to your Unique lifestyle.
      </p>
    </div>


        <!-- Scroll Down Indicator -->
    <div class="scroll-indicator">
      <svg viewBox="0 0 24 24">
        <path d="M12 16.5l-6-6 1.41-1.42L12 13.67l4.59-4.59L18 10.5z"></path>
      </svg>
    </div>

    <!-- Key Features Section -->
    <div class="fade-in-section delay-3">
            <hr>
      <h2>Key Features:</h2>
        <ul class="interactive-list">
          <li>
            <i class="fa-solid fa-user"></i>
            <strong>Custom Simulations:</strong> Explore archetypes like Modern Man or Monk, or build your unique profile.
            <div class="hover-effect">
              <pre id="hover-text-4" class="hidden"></pre>
            </div>
          </li>
          <li>
            <i class="fa-solid fa-chart-area"></i>
            <strong>Realistic Visuals:</strong> See your digestive balance shift across time in a clear <em>React graph</em>.
            <div class="hover-effect">
              <pre id="hover-text-5" class="hidden"></pre>
            </div>
          </li>
          <li>
            <i class="fa-solid fa-lightbulb"></i>
            <strong>Actionable Insights:</strong> Understand how small changes in your routine affect overall digestive health.
            <div class="hover-effect">
              <pre id="hover-text-6" class="hidden"></pre>
            </div>
          </li>
        </ul>

      <p>
        <strong><br>The Food Prophet</strong> empowers you to connect with your body's needs,
        identify patterns, and cultivate healthier habits.
      </p>

      <p>Turn the page to see your personal digestive graph.<br></p>

  <!-- Video Container -->
  <div class="interactive-paragraphs">
    <div class="hover-item">
      <p class="visualize"><i>Visualize</i></p>
      <div class="hover-video left">
        <video autoplay muted loop playsinline>
          <source src="{% static 'images/visualize.mp4' %}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
    </div>
    <div class="hover-item">
      <p class="simulate"><i>Simulate</i></p>
      <div class="hover-video">
        <video autoplay muted loop playsinline>
          <source src="{% static 'images/simulate.mp4' %}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
    </div>
    <div class="hover-item">
      <p class="transform"><i>Transform</i></p>
      <div class="hover-video right">
        <video autoplay muted loop playsinline>
          <source src="{% static 'images/transform.mp4' %}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
    </div>
  </div>


</div>



  </div>

  <!-- React App Mount Point - Entry Point -->
  <div id="root" class="invisible"></div>
  <script src="{{ react_assets.js }}"></script>
  <!-- Re-load CSS so it over-writes incoming app -->
  <link rel="stylesheet" href="{% static 'css/food_prophet.css' %}">


<script>
<!----------------------------------->
<!-- Matrix Machine Writing Script -->
<!----------------------------------->

  document.addEventListener("DOMContentLoaded", () => {
  const textData = [
    "INIT_SYSTEM_LOAD...\nAnalyzing Sleep Schedules...\nSleep Cycles Mapping to existing Datasets...\nIntegrating Meal Timings Information...\nAdding Variance & Normalization...\nMapping Sedentary Intervals and Levels...\nSedentary Level: HIGH\nPeak Inactivity: 4:00 PM - 7:00 PM\nActivity Score: LOW\nDetecting Behavioral Patterns...\nDaytime vs Nighttime Activity Levels: 75% Variance\nOptimal Adjustment Recommendation: READY\nSystem Scan: COMPLETE",
    "Integrating Natural Circadian Rhythms (CR)...\nDetecting Sleep-Wake-Eat Cycles Alignment...\nCR Phase Shift: -2 Hours\nAdjusting Optimal Digestion Windows...\nCalculating Initial Digestion Rate...\nBaseline Rate: 32% Efficiency\nAdjusted for Chronotype: NIGHT OWL\nIntegrating Time Dimension with CR...\nMapping Time-Sensitive Digestion Variations...\nTime Dimension Overlap Factor: MEDIUM\nCalculating Geographical Location...\nLatitude: 40.7128° N\nLongitude: 74.0060° W\nSunrise/Sunset Data: SYNCED\nAdjusting New Digestion Rate & Decay...\nRate: +13%\nDecay Factor: Stabilized at 0.87\nSystem Dynamics: SYNCHRONIZED",
    "Gathering Meal Quantity Data...\nCalculating Meals Probabilistic Models...\nProbability of Overeating: LOW\nMeal Variance Score: MEDIUM\nPredictive Weight Gain Impact: MINIMAL\nCreating Sedentarism Patterns...\nPeriod 1: Sedentary ({time_interval_1}) - High\nPeriod 2: Active ({time_interval_2}) - Low\nPattern Confidence: 89%\nComputing Final Probability Distributions...\nHealthy Digestion Cycle: 74%\nDigestive Stress Events: 3 Potential\nAligning Results with Historical Data...\nGenerating Insights for Adjustments...\nFinal Probability Distribution: COMPLETE",
    "INIT_SYSTEM_LOAD...\nGathering Input Data...\nScanning User Preferences...\nRetrieving Historical User Data…\nValidating Input Sources...\nNormalizing Probabilities...\nAdjusting Multivariate Distributions...\nStandardizing User Metrics...\nCompiling Statistical Weightage...\nSyncing Timeline across Web Workers...\nWeb Workers: ACTIVE\nLoading Custom Archetype...\nSimulation Seed: 0x7F3E1A\nProbability Weights: ADJUSTED\nGenerating Predictive Model...\nBayesian Estimation: COMPLETE\nSystem Status: OK",
    "INITIALIZE_GRAPH_ENGINE...\nRendering Dynamic Graphing...\nEdge Complexity: HIGH\nGraph Type: Multi-Line Time Series\nRunning Parallelism Workflows...\nIntegrating UI Components...\nSynchronizing Graph Animations...\nApplying Real-Time Data Rendering...\nEnsuring Responsive Design...\nViewport: Desktop | Tablet | Mobile\nPreparing Time Dimension Alteration Threads...\nAdjusting Time Granularity...\nSimulating Probabilistic Models...\nConfidence Interval: 93%\nAdjusting Scenarios Dynamically...\nVisual Optimization Complete",
    "INIT_ANALYSIS_ENGINE...\nCalculating Digestive Health Score...\nRunning Impact Assessment...\nGenerating Insights Timeline...\nTimestamps: Day 1 -> Day 14\nScenario Predictions: YES\nCompiling Recommendations...\nMerging with User Data History...\nLogging Interactive Summary...\nActionable Points: 7\nPersonalized Insight Ready\nPreparing Insight Export...\nAnalysis Cycle: COMPLETE"
  ];

  const hoverEffects = document.querySelectorAll(".hover-effect pre");

  hoverEffects.forEach((hoverEffect, index) => {
const parent = hoverEffect.closest("li");
let typingInterval; // Store the interval reference to clear properly
let lineIndex = 0; // Track the current line being written
let charIndex = 0; // Track the current character being written
let lines = []; // Dynamically add lines

parent.addEventListener("mouseover", () => {
if (typingInterval) clearInterval(typingInterval); // Clear any previous intervals
hoverEffect.textContent = ""; // Clear any residual text
lineIndex = 0;
charIndex = 0;
lines = [""]; // Start with one empty line

typingInterval = setInterval(() => {
if (charIndex < textData[index].length) {
const char = textData[index][charIndex];
if (char === "\n" || lines[lineIndex]?.length >= 50) {
// Move to the next line only when necessary
if (lines[lineIndex]?.trim().length > 0) {
lineIndex++;
lines.push(""); // Add a new line
hoverEffect.appendChild(document.createElement("br")); // Add a break
}
charIndex++; // Skip the newline character
} else {
lines[lineIndex] += char;
let currentLineElement = hoverEffect.querySelectorAll(".matrix-line")[lineIndex];
if (!currentLineElement) {
currentLineElement = document.createElement("span");
currentLineElement.className = "matrix-line";
hoverEffect.appendChild(currentLineElement);
}
currentLineElement.textContent = lines[lineIndex];
charIndex++;
}
} else {
clearInterval(typingInterval); // Stop once all text is written
}
}, 11); // Typing speed
});

parent.addEventListener("mouseout", () => {
clearInterval(typingInterval); // Ensure interval is stopped
hoverEffect.textContent = ""; // Clear text on hover out
});

// Add touch events for mobile
parent.addEventListener("touchstart", (e) => {
e.stopPropagation(); // Prevent bubbling to other listeners
if (typingInterval) clearInterval(typingInterval); // Clear any previous intervals
hoverEffect.textContent = ""; // Clear any residual text
lineIndex = 0;
charIndex = 0;
lines = [""]; // Start with one empty line

typingInterval = setInterval(() => {
if (charIndex < textData[index].length) {
const char = textData[index][charIndex];
if (char === "\n" || lines[lineIndex]?.length >= 50) {
if (lines[lineIndex]?.trim().length > 0) {
lineIndex++;
lines.push(""); // Add a new line
hoverEffect.appendChild(document.createElement("br")); // Add a break
}
charIndex++; // Skip the newline character
} else {
lines[lineIndex] += char;
let currentLineElement = hoverEffect.querySelectorAll(".matrix-line")[lineIndex];
if (!currentLineElement) {
currentLineElement = document.createElement("span");
currentLineElement.className = "matrix-line";
hoverEffect.appendChild(currentLineElement);
}
currentLineElement.textContent = lines[lineIndex];
charIndex++;
}
} else {
clearInterval(typingInterval); // Stop once all text is written
}
}, 11); // Typing speed
});

document.addEventListener("touchstart", (e) => {
if (!parent.contains(e.target)) {
clearInterval(typingInterval); // Stop typing
hoverEffect.textContent = ""; // Clear text
}
});

});

});


</script>





<script>
// Override the spark count before the main script
const sparkCount = 200; // Custom spark count

<!------------------------------------------------------->
<!-- JS for hiding & loading React elements on scroll  -->
<!-- Handling PC & Mobile ------------------------------->
<!------------------------------------------------------->

document.addEventListener('DOMContentLoaded', () => {
    // Disable scroll restoration
    if ('scrollRestoration' in history) {
        history.scrollRestoration = 'manual';
    }

    // Ensure page always loads at the top
    window.scrollTo(0, 0);

    const mobile_norm = 2.15; // Normalization factor for mobile
    let lastScrollTop = 0; // To detect changes

    // Utility function to detect mobile devices
    const isMobile = () => /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent);

    // Utility function to get current scroll position
    const getScrollTop = () => Math.max(
        document.body.scrollTop,
        document.documentElement.scrollTop,
        window.pageYOffset || 0
    );

    // Elements to manage
    const contentWrapper = document.querySelector('.content-wrapper');
    const nav = document.querySelector('nav');
    const reactApp = document.getElementById('root');

    // Adjust Login button for specific page and Mobile Env
    const loginBtn = document.getElementById('loginBtn');
     if (isMobile()) {
     loginBtn.style.transform = `translateY(${33}rem) translateX(${-18}rem)`;
    }


    loginBtn.style.display = 'block';
    loginBtn.style.opacity = '1';


    if (!contentWrapper || !nav || !reactApp || !loginBtn) {
        console.error('Required elements not found!');
        return;
    }


  function smoothZoom(target, start, end, duration) {
    const startTime = performance.now(); // Record the start time
    const deltaZoom = end - start; // Total zoom change
    const isMobileDevice = isMobile();

    // Define logic for mobile, skip incremental zoom in/outs as Mobile Browsers do not handle well
    if(isMobileDevice) {
    target.style.zoom = end;
    return;
    }

    function animateZoom(currentTime) {
        const elapsed = currentTime - startTime; // Calculate elapsed time
        const progress = Math.min(elapsed / duration, 1); // Normalize progress (0 to 1)
        const currentZoom = start + deltaZoom * progress; // Calculate current zoom level

        if (progress < 1) {
           target.style.zoom = currentZoom; // Desktop can use zoom
           requestAnimationFrame(animateZoom);
        } else {
            // Ensure final zoom level is set
            target.style.zoom = end;
        }
    }

    requestAnimationFrame(animateZoom); // Start the animation
}



// Add flags to track the current zoom state
let isZoomedIn = false;

    // Scroll handling logic
    function checkScroll() {
        const scrollTop = getScrollTop();

        // In Mobile environments
        // Hiding Nav bar at first scroll event due to Mobile rendering handling causing animation malfunction.
        if(isMobile()) {
        if (scrollTop > 1) {
                nav.classList.remove('visible');
                nav.classList.add('invisible');
        }
        else {

                nav.classList.remove('invisible');
                nav.classList.add('visible');

        }};

        if (scrollTop !== lastScrollTop) {
            lastScrollTop = scrollTop;

            const normalizationFactor = isMobile() ? mobile_norm : 1;
            const contentWrapperTop = contentWrapper.getBoundingClientRect().top + window.scrollY;
            const threshold = contentWrapperTop + 677 * normalizationFactor;

            // console.log(`scrollTop: ${scrollTop}, threshold: ${threshold}, normalizationFactor: ${normalizationFactor}`);

            // Hide navbar and show React app if scrolled past the threshold
            // Past threshold - apply zoom effect to properly render React app

      // Smooth zoom transition
      if (lastScrollTop > threshold && !isZoomedIn) {
            // Trigger zoom in only if not already zoomed in
            isZoomedIn = true;

            document.body.classList.add('background-active');
            if (!isMobile()) {
                nav.classList.remove('visible');
                nav.classList.add('invisible');
            }
            reactApp.classList.remove('invisible');
            reactApp.classList.add('visible');
            smoothZoom(document.body, 1, 0.73, 500); // Zoom in smoothly over 500ms
        } else if (lastScrollTop <= threshold && isZoomedIn) {
            // Trigger zoom out only if currently zoomed in
            isZoomedIn = false;

            document.body.classList.remove('background-active');
            if (!isMobile()) {
                nav.classList.remove('invisible');
                nav.classList.add('visible');
            }
            reactApp.classList.remove('visible');
            reactApp.classList.add('invisible');
            smoothZoom(document.body, 0.73, 1, 500); // Zoom out smoothly over 500ms
        }


<!--            // Mobile-specific behavior for login button-->
<!--            if (isMobile()) {-->
<!--                const loginBtnThresholdStart = contentWrapperTop + 255;-->
<!--                const loginBtnThresholdEnd = contentWrapperTop + 777;-->

<!--                if (scrollTop >= loginBtnThresholdStart && scrollTop < loginBtnThresholdEnd) {-->
<!--                    loginBtn.style.display = 'block';-->
<!--                    loginBtn.style.opacity = '1';-->
<!--                    loginBtn.style.transform = `translateY(${scrollTop}px)`;-->
<!--                } else {-->
<!--                    loginBtn.style.opacity = '0';-->
<!--                }-->
<!--            }-->

<!--            // Log scroll data-->
<!--            fetch('/log-scroll/', {-->
<!--                method: 'POST',-->
<!--                headers: {-->
<!--                    'Content-Type': 'application/json',-->
<!--                    'X-CSRFToken': getCookie('csrftoken'), // Django CSRF token-->
<!--                },-->
<!--                body: JSON.stringify({ scrollTop, threshold }),-->
<!--            }).catch(error => console.error('Error logging scroll:', error));-->
        }

        requestAnimationFrame(checkScroll);
    }

    // Start scroll monitoring
    requestAnimationFrame(checkScroll);

    // Utility function to get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === name + '=') {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});


</script>



<!-- Trouble-shooting scroll behavior on different elements -->
<!--<script src="{% static 'scroll_behavior.js' %}"></script>-->


</body>

{% endblock %}
</html>
